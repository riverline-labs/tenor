---
phase: 13-domain-re-validation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - domains/saas/saas_subscription.tenor
  - domains/saas/saas_activate.tenor
  - domains/saas/saas_activate.facts.json
  - domains/saas/saas_activate.verdicts.json
  - domains/saas/saas_suspend.tenor
  - domains/saas/saas_suspend.facts.json
  - domains/saas/saas_suspend.verdicts.json
autonomous: true
requirements: [DOMN-10]

must_haves:
  truths:
    - "SaaS subscription contract elaborates cleanly under v1.0 spec"
    - "tenor check produces clean results (no findings beyond acknowledged limitations)"
    - "Evaluation fixtures produce correct verdicts matching expected outputs"
    - "Contract exercises System construct features where applicable (persona, entity, operation outcomes)"
  artifacts:
    - path: "domains/saas/saas_subscription.tenor"
      provides: "SaaS subscription lifecycle contract validated for v1.0"
    - path: "domains/saas/saas_activate.verdicts.json"
      provides: "Activation scenario evaluation verdicts"
    - path: "domains/saas/saas_suspend.verdicts.json"
      provides: "Suspension scenario evaluation verdicts"
  key_links:
    - from: "domains/saas/saas_subscription.tenor"
      to: "tenor elaborate"
      via: "elaboration pipeline"
      pattern: "cargo run -p tenor-cli -- elaborate"
    - from: "domains/saas/saas_subscription.tenor"
      to: "tenor check"
      via: "static analysis pipeline"
      pattern: "cargo run -p tenor-cli -- check"
---

<objective>
Re-validate the SaaS subscription domain contract against the v1.0 spec.

Purpose: Confirm the SaaS contract (TypeDecl Record, Enum/Bool facts, entity state machine, multi-stratum rules, persona-restricted operations, linear flow with branch) elaborates cleanly, passes static analysis, and evaluates correctly under v1.0.

Output: Validated SaaS contract with updated evaluation fixtures if needed, clean elaboration and check results.
</objective>

<execution_context>
@/Users/bwb/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bwb/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@domains/saas/saas_subscription.tenor
@domains/saas/saas_activate.tenor
@domains/saas/saas_activate.facts.json
@domains/saas/saas_activate.verdicts.json
@domains/saas/saas_suspend.tenor
@domains/saas/saas_suspend.facts.json
@domains/saas/saas_suspend.verdicts.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Validate SaaS contract elaboration and static analysis under v1.0</name>
  <files>domains/saas/saas_subscription.tenor</files>
  <action>
1. Read `domains/saas/saas_subscription.tenor` and audit against v1.0 spec (`docs/TENOR.md`):
   - Verify all construct syntax matches v1.0 (persona declarations, operation outcomes/error_contract, flow snapshot/entry, entity transitions)
   - Check that the contract exercises a meaningful breadth of v1.0 features: TypeDecl Record, Enum fact, Bool fact with default, entity state machine, multi-stratum rules (stratum 0 + 1), persona-restricted operations, linear flow with BranchStep
   - If any syntax needs updating for v1.0 compliance, update the .tenor file

2. Run `cargo run -p tenor-cli -- elaborate domains/saas/saas_subscription.tenor` and verify clean JSON output (no errors)

3. Run `cargo run -p tenor-cli -- check domains/saas/saas_subscription.tenor` and verify clean results:
   - Confirm entity reachability, authority topology, flow paths all report correctly
   - Document any findings (should be zero or only acknowledged limitations)

4. If the contract needs updates for v1.0 spec compliance, also update the companion flow files (`saas_activate.tenor`, `saas_suspend.tenor`) if they exist as separate .tenor files.

Note: The existing contract was authored during Phase 5 (v0.9) and may already be fully v1.0 compliant since the spec additions (System construct, AAP audit) are additive. The key task is verification, not rewrite.
  </action>
  <verify>
- `cargo run -p tenor-cli -- elaborate domains/saas/saas_subscription.tenor` exits 0 with valid JSON
- `cargo run -p tenor-cli -- check domains/saas/saas_subscription.tenor` exits 0 with "No findings" or only acknowledged limitations
  </verify>
  <done>SaaS subscription contract elaborates and passes static analysis under v1.0 spec</done>
</task>

<task type="auto">
  <name>Task 2: Validate SaaS evaluation fixtures and verdict correctness</name>
  <files>
domains/saas/saas_activate.facts.json
domains/saas/saas_activate.verdicts.json
domains/saas/saas_suspend.facts.json
domains/saas/saas_suspend.verdicts.json
  </files>
  <action>
1. Elaborate the SaaS contract to a bundle JSON file:
   `cargo run -p tenor-cli -- elaborate domains/saas/saas_subscription.tenor > /tmp/saas_bundle.json`

2. For each evaluation scenario (activate, suspend):
   a. Run the evaluator: `cargo run -p tenor-cli -- eval /tmp/saas_bundle.json --facts domains/saas/saas_{scenario}.facts.json`
   b. Compare the output against the existing `.verdicts.json` file
   c. If verdicts differ, investigate whether the contract change or the expected file needs updating
   d. Update `.verdicts.json` files to match actual evaluator output if the evaluator is correct

3. Verify each scenario exercises the expected contract paths:
   - `saas_activate`: Should produce activation_approved verdict, flow outcome "activated"
   - `saas_suspend`: Should produce suspension_required verdict, flow outcome "suspended"

4. If any .verdicts.json files were regenerated, ensure the verdict structure matches the evaluator output format (verdicts array with provenance, flow_outcome, steps_executed).
  </action>
  <verify>
- `cargo run -p tenor-cli -- eval /tmp/saas_bundle.json --facts domains/saas/saas_activate.facts.json` output matches `domains/saas/saas_activate.verdicts.json`
- `cargo run -p tenor-cli -- eval /tmp/saas_bundle.json --facts domains/saas/saas_suspend.facts.json` output matches `domains/saas/saas_suspend.verdicts.json`
  </verify>
  <done>Both SaaS evaluation scenarios (activate, suspend) produce correct verdicts matching expected outputs</done>
</task>

</tasks>

<verification>
- SaaS contract elaborates without errors under v1.0
- Static analysis produces clean results
- Both evaluation scenarios produce correct verdicts
- No regressions in conformance suite: `cargo run -p tenor-cli -- test conformance`
</verification>

<success_criteria>
DOMN-10 satisfied: SaaS subscription contract is validated for v1.0 spec with clean elaboration, analysis, and evaluation results.
</success_criteria>

<output>
After completion, create `.planning/phases/13-domain-re-validation/13-01-SUMMARY.md`
</output>
