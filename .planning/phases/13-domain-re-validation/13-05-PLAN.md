---
phase: 13-domain-re-validation
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - domains/trade_finance/letter_of_credit.tenor
  - domains/trade_finance/lc_present.facts.json
  - domains/trade_finance/lc_present.verdicts.json
  - domains/trade_finance/lc_discrepancy.facts.json
  - domains/trade_finance/lc_discrepancy.verdicts.json
autonomous: true
requirements: [DOMN-14]

must_haves:
  truths:
    - "Trade finance letter of credit contract elaborates cleanly under v1.0 spec"
    - "tenor check produces clean results (no findings beyond acknowledged limitations)"
    - "Both evaluation scenarios (present, discrepancy) produce correct verdicts"
    - "Contract exercises multi-party personas (5), Money types/comparisons, Date types, document entity state machine, bounded quantification, HandoffStep, BranchStep compliance routing"
  artifacts:
    - path: "domains/trade_finance/letter_of_credit.tenor"
      provides: "Trade finance letter of credit contract validated for v1.0"
    - path: "domains/trade_finance/lc_present.verdicts.json"
      provides: "Compliant presentation scenario evaluation verdicts"
    - path: "domains/trade_finance/lc_discrepancy.verdicts.json"
      provides: "Discrepancy scenario evaluation verdicts"
  key_links:
    - from: "domains/trade_finance/letter_of_credit.tenor"
      to: "tenor elaborate"
      via: "elaboration pipeline"
      pattern: "cargo run -p tenor-cli -- elaborate"
    - from: "domains/trade_finance/letter_of_credit.tenor"
      to: "tenor check"
      via: "static analysis pipeline"
      pattern: "cargo run -p tenor-cli -- check"
---

<objective>
Re-validate the trade finance letter of credit domain contract against the v1.0 spec.

Purpose: Confirm the trade finance contract -- exercising multi-party personas (5 international trade parties), Money types with comparisons (LC face value vs draft amount), Date types (expiry/presentation dates), document entity state machine, bounded universal quantification, HandoffStep (persona handoffs between beneficiary/advising bank/issuing bank), and BranchStep compliance routing -- elaborates cleanly, passes static analysis, and evaluates correctly under v1.0.

Output: Validated trade finance contract with updated evaluation fixtures if needed, clean elaboration and check results.
</objective>

<execution_context>
@/Users/bwb/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bwb/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@domains/trade_finance/letter_of_credit.tenor
@domains/trade_finance/lc_present.facts.json
@domains/trade_finance/lc_present.verdicts.json
@domains/trade_finance/lc_discrepancy.facts.json
@domains/trade_finance/lc_discrepancy.verdicts.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Validate trade finance contract elaboration and static analysis under v1.0</name>
  <files>domains/trade_finance/letter_of_credit.tenor</files>
  <action>
1. Read `domains/trade_finance/letter_of_credit.tenor` and audit against v1.0 spec (`docs/TENOR.md`):
   - Verify all construct syntax matches v1.0 (persona declarations for 5 parties, Money literal and comparison syntax, Date type usage, operation outcomes/error_contract, HandoffStep syntax with from_persona/to_persona/next, BranchStep syntax, entity transitions)
   - Confirm the contract exercises: 5 personas (applicant, beneficiary, issuing_bank, advising_bank, confirming_bank), Money(currency: "USD") with draft_amount <= lc_amount comparison, Date comparison (presentation_date <= expiry_date), DocumentRequirement record type with bounded quantification, dual entities (LetterOfCredit, Document), HandoffStep for persona transfers, BranchStep for compliance routing
   - If any syntax needs updating for v1.0 compliance, update the .tenor file

2. Run `cargo run -p tenor-cli -- elaborate domains/trade_finance/letter_of_credit.tenor` and verify clean JSON output

3. Run `cargo run -p tenor-cli -- check domains/trade_finance/letter_of_credit.tenor` and verify results:
   - Confirm entity reachability for both entities (LetterOfCredit, Document)
   - Confirm authority topology for 5 personas
   - Confirm flow path analysis for lc_presentation_flow with HandoffSteps and BranchStep
   - Document any findings
  </action>
  <verify>
- `cargo run -p tenor-cli -- elaborate domains/trade_finance/letter_of_credit.tenor` exits 0 with valid JSON
- `cargo run -p tenor-cli -- check domains/trade_finance/letter_of_credit.tenor` exits 0 with clean results
  </verify>
  <done>Trade finance letter of credit contract elaborates and passes static analysis under v1.0 spec</done>
</task>

<task type="auto">
  <name>Task 2: Validate trade finance evaluation fixtures and verdict correctness</name>
  <files>
domains/trade_finance/lc_present.facts.json
domains/trade_finance/lc_present.verdicts.json
domains/trade_finance/lc_discrepancy.facts.json
domains/trade_finance/lc_discrepancy.verdicts.json
  </files>
  <action>
1. Elaborate the trade finance contract to a bundle JSON file:
   `cargo run -p tenor-cli -- elaborate domains/trade_finance/letter_of_credit.tenor > /tmp/trade_bundle.json`

2. For each evaluation scenario (present, discrepancy):
   a. Run the evaluator: `cargo run -p tenor-cli -- eval /tmp/trade_bundle.json --facts domains/trade_finance/lc_{scenario}.facts.json`
   b. Compare the output against the existing `.verdicts.json` file
   c. If verdicts differ, investigate and update `.verdicts.json` to match correct evaluator output

3. Verify each scenario exercises the expected contract paths:
   - `lc_present`: All documents present and valid, amount within LC, presentation before expiry -- should produce presentation_compliant verdict, flow outcome "success" through handoff -> examine -> accept -> pay path
   - `lc_discrepancy`: Missing or invalid documents, or amount exceeds LC, or late presentation -- should produce has_discrepancy verdict, flow outcome "discrepant" through handoff -> examine -> raise_discrepancy path

4. If any .verdicts.json files were regenerated, ensure the verdict structure matches the evaluator output format.
  </action>
  <verify>
- Both evaluation scenarios produce verdicts matching expected output files
- Flow outcomes match expected paths (including HandoffStep execution)
  </verify>
  <done>Both trade finance evaluation scenarios (present, discrepancy) produce correct verdicts</done>
</task>

</tasks>

<verification>
- Trade finance contract elaborates without errors under v1.0
- Static analysis produces clean results for multi-party contract
- Both evaluation scenarios produce correct verdicts
- No regressions in conformance suite: `cargo run -p tenor-cli -- test conformance`
</verification>

<success_criteria>
DOMN-14 satisfied: Trade finance letter of credit contract is validated for v1.0 spec with clean elaboration, analysis, and evaluation results.
</success_criteria>

<output>
After completion, create `.planning/phases/13-domain-re-validation/13-05-SUMMARY.md`
</output>
