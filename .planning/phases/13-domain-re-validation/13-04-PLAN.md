---
phase: 13-domain-re-validation
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - domains/energy_procurement/rfp_workflow.tenor
  - domains/energy_procurement/types.tenor
  - domains/energy_procurement/rfp_approve.facts.json
  - domains/energy_procurement/rfp_approve.verdicts.json
  - domains/energy_procurement/rfp_reject.facts.json
  - domains/energy_procurement/rfp_reject.verdicts.json
  - domains/energy_procurement/rfp_escalate.facts.json
  - domains/energy_procurement/rfp_escalate.verdicts.json
autonomous: true
requirements: [DOMN-13]

must_haves:
  truths:
    - "Energy procurement contract elaborates cleanly under v1.0 spec"
    - "tenor check produces clean results (no findings beyond acknowledged limitations)"
    - "All three evaluation scenarios (approve, reject, escalate) produce correct verdicts"
    - "Contract exercises Money types with comparisons, Date types, approval tier BranchStep routing, Escalate handler, multi-entity effects, bounded quantification, multi-file import"
  artifacts:
    - path: "domains/energy_procurement/rfp_workflow.tenor"
      provides: "Energy procurement RFP workflow contract validated for v1.0"
    - path: "domains/energy_procurement/types.tenor"
      provides: "Shared type definitions for energy domain"
    - path: "domains/energy_procurement/rfp_approve.verdicts.json"
      provides: "Approval scenario evaluation verdicts"
    - path: "domains/energy_procurement/rfp_reject.verdicts.json"
      provides: "Rejection scenario evaluation verdicts"
    - path: "domains/energy_procurement/rfp_escalate.verdicts.json"
      provides: "Escalation scenario evaluation verdicts"
  key_links:
    - from: "domains/energy_procurement/rfp_workflow.tenor"
      to: "tenor elaborate"
      via: "elaboration pipeline (multi-file with import)"
      pattern: "cargo run -p tenor-cli -- elaborate"
    - from: "domains/energy_procurement/rfp_workflow.tenor"
      to: "tenor check"
      via: "static analysis pipeline"
      pattern: "cargo run -p tenor-cli -- check"
---

<objective>
Re-validate the energy procurement RFP workflow domain contract against the v1.0 spec.

Purpose: Confirm the energy procurement contract -- exercising Money types with comparisons, Date types, approval tier routing via BranchStep, Escalate handler, multi-entity effects (RFP + PurchaseOrder), bounded universal quantification, and multi-file import -- elaborates cleanly, passes static analysis, and evaluates correctly under v1.0.

Output: Validated energy procurement contract with updated evaluation fixtures if needed, clean elaboration and check results.
</objective>

<execution_context>
@/Users/bwb/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bwb/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@domains/energy_procurement/rfp_workflow.tenor
@domains/energy_procurement/types.tenor
@domains/energy_procurement/rfp_approve.facts.json
@domains/energy_procurement/rfp_approve.verdicts.json
@domains/energy_procurement/rfp_reject.facts.json
@domains/energy_procurement/rfp_reject.verdicts.json
@domains/energy_procurement/rfp_escalate.facts.json
@domains/energy_procurement/rfp_escalate.verdicts.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Validate energy procurement contract elaboration and static analysis under v1.0</name>
  <files>
domains/energy_procurement/rfp_workflow.tenor
domains/energy_procurement/types.tenor
  </files>
  <action>
1. Read `domains/energy_procurement/rfp_workflow.tenor` and `domains/energy_procurement/types.tenor` and audit against v1.0 spec (`docs/TENOR.md`):
   - Verify all construct syntax matches v1.0 (import mechanism, Money literal syntax in rule conditions, Date type usage, operation outcomes/error_contract, Escalate handler syntax, entity transitions)
   - Confirm the contract exercises: Money(currency: "USD") with comparison operators (<=, >), approval tier determination via multi-stratum rules, BranchStep routing for tier-based approval, Escalate handler (category_lead escalation to vp_supply_chain), multi-entity effects (RFP + PurchaseOrder), bounded quantification (forall bid in supplier_bids)
   - Pay special attention to Money literal syntax in rules: `Money { amount: "50000.00", currency: "USD" }` -- verify this matches v1.0 spec requirements
   - If any syntax needs updating for v1.0 compliance, update the .tenor files

2. Run `cargo run -p tenor-cli -- elaborate domains/energy_procurement/rfp_workflow.tenor` and verify clean JSON output

3. Run `cargo run -p tenor-cli -- check domains/energy_procurement/rfp_workflow.tenor` and verify results:
   - Confirm entity reachability for both entities (RFP, PurchaseOrder)
   - Confirm authority topology for 5 personas
   - Confirm flow path analysis for rfp_approval_flow with tier branching
   - Document any findings
  </action>
  <verify>
- `cargo run -p tenor-cli -- elaborate domains/energy_procurement/rfp_workflow.tenor` exits 0 with valid JSON
- `cargo run -p tenor-cli -- check domains/energy_procurement/rfp_workflow.tenor` exits 0 with clean results
  </verify>
  <done>Energy procurement contract elaborates and passes static analysis under v1.0 spec</done>
</task>

<task type="auto">
  <name>Task 2: Validate energy procurement evaluation fixtures and verdict correctness</name>
  <files>
domains/energy_procurement/rfp_approve.facts.json
domains/energy_procurement/rfp_approve.verdicts.json
domains/energy_procurement/rfp_reject.facts.json
domains/energy_procurement/rfp_reject.verdicts.json
domains/energy_procurement/rfp_escalate.facts.json
domains/energy_procurement/rfp_escalate.verdicts.json
  </files>
  <action>
1. Elaborate the energy procurement contract to a bundle JSON file:
   `cargo run -p tenor-cli -- elaborate domains/energy_procurement/rfp_workflow.tenor > /tmp/energy_bundle.json`

2. For each evaluation scenario (approve, reject, escalate):
   a. Run the evaluator: `cargo run -p tenor-cli -- eval /tmp/energy_bundle.json --facts domains/energy_procurement/rfp_{scenario}.facts.json`
   b. Compare the output against the existing `.verdicts.json` file
   c. If verdicts differ, investigate and update `.verdicts.json` to match correct evaluator output

3. Verify each scenario exercises the expected contract paths:
   - `rfp_approve`: Budget approved, compliance ok, sufficient bids, score above threshold, amount below $50k (PM tier) -- should produce award_ready verdict, flow outcome "awarded" via direct approval path
   - `rfp_reject`: Budget not approved or compliance not checked -- should produce award_blocked verdict, flow terminates
   - `rfp_escalate`: Amount between $50k-$500k (category lead tier), category lead award fails, escalates to VP -- should exercise Escalate handler

4. If any .verdicts.json files were regenerated, ensure the verdict structure matches the evaluator output format.
  </action>
  <verify>
- All three evaluation scenarios produce verdicts matching expected output files
- Flow outcomes match expected paths (including escalation path)
  </verify>
  <done>All three energy procurement evaluation scenarios (approve, reject, escalate) produce correct verdicts</done>
</task>

</tasks>

<verification>
- Energy procurement contract elaborates without errors under v1.0 (including import resolution)
- Static analysis produces clean results for multi-entity, money-comparison contract
- All three evaluation scenarios produce correct verdicts
- No regressions in conformance suite: `cargo run -p tenor-cli -- test conformance`
</verification>

<success_criteria>
DOMN-13 satisfied: Energy procurement RFP workflow contract is validated for v1.0 spec with clean elaboration, analysis, and evaluation results.
</success_criteria>

<output>
After completion, create `.planning/phases/13-domain-re-validation/13-04-SUMMARY.md`
</output>
