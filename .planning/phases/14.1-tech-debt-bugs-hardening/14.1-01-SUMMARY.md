---
phase: 14.1-tech-debt-bugs-hardening
plan: 01
subsystem: core
tags: [version-constants, deduplication, tech-debt, refactoring]

# Dependency graph
requires: []
provides:
  - TENOR_VERSION and TENOR_BUNDLE_VERSION constants in tenor-core
  - Shared manifest module (compute_etag, build_manifest) in tenor-cli
affects: [all-future-version-bumps, manifest-tests, serialization]

# Tech tracking
tech-stack:
  added: []
  patterns: [single-source version constants, shared module extraction]

key-files:
  created:
    - crates/cli/src/manifest.rs
  modified:
    - crates/core/src/lib.rs
    - crates/core/src/pass6_serialize.rs
    - crates/cli/src/main.rs
    - crates/cli/src/runner.rs
    - crates/analyze/src/bundle.rs
    - crates/analyze/src/lib.rs

key-decisions:
  - "Version constants defined in tenor-core lib.rs as pub const, importable by all crates"
  - "Manifest version (1.1) kept as local constant in manifest.rs since it applies only to manifest envelopes"

patterns-established:
  - "Single-source version: All version strings derive from constants in crates/core/src/lib.rs"
  - "Shared manifest: CLI and conformance runner both import from crates/cli/src/manifest.rs"

requirements-completed: []

# Metrics
duration: 3min
completed: 2026-02-23
---

# Phase 14.1 Plan 01: Version Constants and Manifest Deduplication Summary

**Centralized 9 hardcoded version strings into two constants in tenor-core and extracted duplicated manifest/etag logic into shared manifest.rs module**

## Performance

- **Duration:** 3 min
- **Started:** 2026-02-23T00:30:20Z
- **Completed:** 2026-02-23T00:34:04Z
- **Tasks:** 2
- **Files modified:** 7

## Accomplishments
- All version strings (TENOR_VERSION "1.0" and TENOR_BUNDLE_VERSION "1.1.0") now derive from single constants in tenor-core
- Stale "1.0.0" version in analyze test helpers updated to use TENOR_BUNDLE_VERSION
- Manifest/etag logic exists in exactly one place (crates/cli/src/manifest.rs)
- All 72 conformance tests, all unit tests, and all 5 quality gates pass

## Task Commits

Each task was committed atomically:

1. **Task 1: Define version constants and replace all hardcoded version strings** - `bb95e67` (feat)
2. **Task 2: Extract manifest/etag logic into shared module** - `3c3e796` (refactor)

## Files Created/Modified
- `crates/core/src/lib.rs` - Added TENOR_VERSION and TENOR_BUNDLE_VERSION public constants
- `crates/core/src/pass6_serialize.rs` - Replaced 9 hardcoded version strings with constant references
- `crates/analyze/src/bundle.rs` - Updated test helper to use TENOR_BUNDLE_VERSION
- `crates/analyze/src/lib.rs` - Updated test helper to use TENOR_BUNDLE_VERSION
- `crates/cli/src/manifest.rs` - New shared module with compute_etag and build_manifest
- `crates/cli/src/main.rs` - Removed inline manifest functions, imports from manifest module
- `crates/cli/src/runner.rs` - Removed inline SHA-256/manifest logic, imports from manifest module

## Decisions Made
- Version constants placed in tenor-core lib.rs (crate root) since they are used by multiple crates
- Manifest envelope version ("1.1") kept as a local constant in manifest.rs rather than deriving from TENOR_BUNDLE_VERSION, since the manifest version is a distinct concept from the bundle version

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered
None

## User Setup Required
None - no external service configuration required.

## Next Phase Readiness
- Version bump workflow is now single-edit: change constants in crates/core/src/lib.rs
- Manifest logic is centralized, ready for any future manifest format changes
- All quality gates green, ready for next plan in phase 14.1

## Self-Check: PASSED

All files exist, all commits verified.

---
*Phase: 14.1-tech-debt-bugs-hardening*
*Completed: 2026-02-23*
