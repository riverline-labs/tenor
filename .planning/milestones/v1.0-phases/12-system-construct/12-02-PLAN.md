---
phase: 12-system-construct
plan: 02
type: execute
wave: 2
depends_on:
  - 12-01
files_modified:
  - docs/TENOR.md
autonomous: true
requirements:
  - SYS-05
  - EXEC-01
  - EXEC-02

must_haves:
  truths:
    - "The System construct has a formal spec section in docs/TENOR.md with definition, semantics, constraints, interchange representation"
    - "Executor obligations for cross-contract snapshot coordination are defined in the spec"
    - "Executor obligations for cross-contract persona resolution are defined in the spec"
  artifacts:
    - path: "docs/TENOR.md"
      provides: "System construct spec section with syntax, semantics, constraints, interchange, executor obligations"
      contains: "System"
  key_links:
    - from: "docs/cffp/system.json"
      to: "docs/TENOR.md"
      via: "CFFP canonical form translated to spec prose"
      pattern: "canonical_form"
---

<objective>
Translate the CFFP canonical form for the System construct into a formal specification section in docs/TENOR.md, including executor obligations for cross-contract coordination.

Purpose: The spec section is the authoritative reference for all implementation work. Executor obligations (EXEC-01, EXEC-02) define what a conforming runtime must do for cross-contract snapshot coordination and persona resolution within a System.

Output: Updated docs/TENOR.md with a new System section and extended executor obligation section.
</objective>

<execution_context>
@/Users/bwb/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bwb/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-system-construct/12-01-SUMMARY.md
@docs/TENOR.md
@docs/cffp/system.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write System construct spec section in TENOR.md</name>
  <files>docs/TENOR.md</files>
  <action>
Read the CFFP canonical form from docs/cffp/system.json (plan 01 output) and translate it into a new spec section in docs/TENOR.md.

Follow the established 5-subsection pattern from prior construct sections (Persona, Operation, Flow):
1. **Definition** — What a System is, what it declares, formal syntax
2. **Semantics** — Member contract resolution, shared persona binding, cross-contract flow triggers, cross-contract entity relationships
3. **Constraints** — Elaborator-enforced structural rules (derived from CFFP invariants)
4. **Provenance** — How System provenance appears in interchange output
5. **Interchange Representation** — Canonical JSON structure for the System construct

Place the System section after the Flow section (Section 11) as Section 12. Renumber subsequent sections (Evaluation → 13, Interchange → 14, Static Analysis → 15, Versioning → 16, etc.).

**DSL Syntax** (from CFFP canonical form — use lowercase `system` keyword per CLAUDE.md):
Include the concrete DSL syntax for declaring a System with:
- Member contract declarations
- Shared persona bindings
- Cross-contract flow triggers
- Cross-contract entity relationships

**Constraints Section:**
Translate each CFFP invariant into a spec constraint with:
- Constraint ID (C-SYS-nn)
- Description
- Pass that enforces it (Pass 2 for indexing, Pass 5 for structural validation)
- Error produced on violation

**Acknowledged Limitations:**
Add new AL-series entries from the CFFP artifact to Appendix A.
  </action>
  <verify>
1. `grep -c "System" docs/TENOR.md` — System appears multiple times in the spec
2. The spec section contains all 5 subsections (Definition, Semantics, Constraints, Provenance, Interchange Representation)
3. DSL syntax uses lowercase `system` keyword
4. Constraints reference specific elaboration passes
  </verify>
  <done>
docs/TENOR.md contains a complete System construct section with formal syntax, semantics, constraints, provenance, and interchange representation — all derived from the CFFP canonical form.
  </done>
</task>

<task type="auto">
  <name>Task 2: Define executor obligations for cross-contract coordination</name>
  <files>docs/TENOR.md</files>
  <action>
In the executor obligations section of docs/TENOR.md (currently Section 14, will be renumbered), add new executor obligations for System construct support:

**EXEC-01: Cross-contract snapshot coordination (E-SYS-01 through E-SYS-nn):**
- When a System is evaluated, the executor MUST create a coordinated snapshot across all member contracts
- The snapshot for each member contract includes its own facts, verdicts, and entity states
- Cross-contract flow triggers MUST use the coordinated snapshot — the target contract's snapshot is frozen at the same logical moment as the source contract's
- Define what "same logical moment" means for the executor (atomicity requirements)
- Define the behavior when a cross-contract flow trigger fires: which snapshot does the target flow see?

**EXEC-02: Cross-contract persona resolution (E-SYS-nn through E-SYS-mm):**
- When a persona is declared as shared across member contracts in a System, the executor MUST treat operations in different contracts bearing that persona as executed by the same actor
- The persona resolution obligation: given a shared persona binding in the System, the executor resolves persona references in each member contract to the System-level shared identity
- Define the interaction between shared personas and per-contract allowed_personas sets

Write these obligations in the same style as existing E-series obligations (M-series for migration). Use clear MUST/SHOULD/MAY language consistent with the spec's existing style.
  </action>
  <verify>
1. `grep -c "E-SYS" docs/TENOR.md` — executor obligations exist
2. Obligations cover cross-contract snapshot coordination (EXEC-01)
3. Obligations cover cross-contract persona resolution (EXEC-02)
4. Obligations use MUST/SHOULD/MAY language
  </verify>
  <done>
docs/TENOR.md executor obligations section includes new E-SYS-series obligations covering cross-contract snapshot coordination and persona resolution, with clear atomicity and resolution semantics.
  </done>
</task>

</tasks>

<verification>
- docs/TENOR.md has a complete System construct section
- Executor obligations for EXEC-01 and EXEC-02 are formally defined
- All section numbering is consistent after the insertion
- Acknowledged limitations are added to Appendix A
</verification>

<success_criteria>
The spec is authoritative and complete for the System construct. An implementer can read docs/TENOR.md and know exactly what DSL syntax to parse, what validation to perform, what interchange JSON to produce, and what executor obligations apply.
</success_criteria>

<output>
After completion, create `.planning/phases/12-system-construct/12-02-SUMMARY.md`
</output>
