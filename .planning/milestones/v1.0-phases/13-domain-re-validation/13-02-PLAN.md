---
phase: 13-domain-re-validation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - domains/healthcare/prior_auth.tenor
  - domains/healthcare/prior_auth_approve.facts.json
  - domains/healthcare/prior_auth_approve.verdicts.json
  - domains/healthcare/prior_auth_deny.facts.json
  - domains/healthcare/prior_auth_deny.verdicts.json
  - domains/healthcare/prior_auth_appeal.facts.json
  - domains/healthcare/prior_auth_appeal.verdicts.json
autonomous: true
requirements: [DOMN-11]

must_haves:
  truths:
    - "Healthcare prior auth contract elaborates cleanly under v1.0 spec"
    - "tenor check produces clean results (no findings beyond acknowledged limitations)"
    - "All three evaluation scenarios (approve, deny, appeal) produce correct verdicts"
    - "Contract exercises deep v1.0 features: SubFlowStep, Escalate handler, multi-stratum rules (4 strata), 6 personas, Record types, bounded quantification, HandoffStep"
  artifacts:
    - path: "domains/healthcare/prior_auth.tenor"
      provides: "Healthcare prior authorization lifecycle contract validated for v1.0"
    - path: "domains/healthcare/prior_auth_approve.verdicts.json"
      provides: "Approval scenario evaluation verdicts"
    - path: "domains/healthcare/prior_auth_deny.verdicts.json"
      provides: "Denial scenario evaluation verdicts"
    - path: "domains/healthcare/prior_auth_appeal.verdicts.json"
      provides: "Appeal scenario evaluation verdicts"
  key_links:
    - from: "domains/healthcare/prior_auth.tenor"
      to: "tenor elaborate"
      via: "elaboration pipeline"
      pattern: "cargo run -p tenor-cli -- elaborate"
    - from: "domains/healthcare/prior_auth.tenor"
      to: "tenor check"
      via: "static analysis pipeline"
      pattern: "cargo run -p tenor-cli -- check"
---

<objective>
Re-validate the healthcare prior authorization domain contract against the v1.0 spec.

Purpose: Confirm the healthcare contract -- the most complex domain contract exercising SubFlowStep, Escalate handlers, multi-stratum rules (4 strata), 6 personas, Record types, bounded universal quantification, and HandoffStep -- elaborates cleanly, passes static analysis, and evaluates correctly under v1.0.

Output: Validated healthcare contract with updated evaluation fixtures if needed, clean elaboration and check results.
</objective>

<execution_context>
@/Users/bwb/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bwb/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@domains/healthcare/prior_auth.tenor
@domains/healthcare/prior_auth_approve.facts.json
@domains/healthcare/prior_auth_approve.verdicts.json
@domains/healthcare/prior_auth_deny.facts.json
@domains/healthcare/prior_auth_deny.verdicts.json
@domains/healthcare/prior_auth_appeal.facts.json
@domains/healthcare/prior_auth_appeal.verdicts.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Validate healthcare contract elaboration and static analysis under v1.0</name>
  <files>domains/healthcare/prior_auth.tenor</files>
  <action>
1. Read `domains/healthcare/prior_auth.tenor` and audit against v1.0 spec (`docs/TENOR.md`):
   - Verify all construct syntax matches v1.0 (persona declarations, operation outcomes/error_contract, flow snapshot/entry, SubFlowStep syntax, Escalate handler syntax, HandoffStep syntax, entity transitions)
   - Confirm the contract exercises wide v1.0 feature coverage: TypeDecl Records (PolicyCriteria, ReviewRecord, MedicalRecord), List facts with bounded quantification, 6 personas, 4 rule strata, multi-entity operations, SubFlowStep, Escalate handler, HandoffStep
   - If any syntax needs updating for v1.0 compliance, update the .tenor file

2. Run `cargo run -p tenor-cli -- elaborate domains/healthcare/prior_auth.tenor` and verify clean JSON output (no errors)

3. Run `cargo run -p tenor-cli -- check domains/healthcare/prior_auth.tenor` and verify results:
   - Confirm entity reachability (PriorAuth, AppealCase), authority topology (6 personas), flow paths (auth_review_flow, appeal_flow) all report correctly
   - Document any findings

4. This is the "showcase" contract -- the widest feature coverage of any domain. Extra care on:
   - Escalate handler in step_deny (to: medical_director, next: step_director_review)
   - SubFlowStep in step_appeal_subflow (flow: appeal_flow)
   - HandoffStep in step_handoff_to_board (from: requesting_physician, to: appeals_board)
   - 4-stratum rule chain (stratum 0 -> 1 -> 2 -> 3)
  </action>
  <verify>
- `cargo run -p tenor-cli -- elaborate domains/healthcare/prior_auth.tenor` exits 0 with valid JSON
- `cargo run -p tenor-cli -- check domains/healthcare/prior_auth.tenor` exits 0 with clean results
  </verify>
  <done>Healthcare prior auth contract elaborates and passes static analysis under v1.0 spec</done>
</task>

<task type="auto">
  <name>Task 2: Validate healthcare evaluation fixtures and verdict correctness</name>
  <files>
domains/healthcare/prior_auth_approve.facts.json
domains/healthcare/prior_auth_approve.verdicts.json
domains/healthcare/prior_auth_deny.facts.json
domains/healthcare/prior_auth_deny.verdicts.json
domains/healthcare/prior_auth_appeal.facts.json
domains/healthcare/prior_auth_appeal.verdicts.json
  </files>
  <action>
1. Elaborate the healthcare contract to a bundle JSON file:
   `cargo run -p tenor-cli -- elaborate domains/healthcare/prior_auth.tenor > /tmp/healthcare_bundle.json`

2. For each evaluation scenario (approve, deny, appeal):
   a. Run the evaluator: `cargo run -p tenor-cli -- eval /tmp/healthcare_bundle.json --facts domains/healthcare/prior_auth_{scenario}.facts.json`
   b. Compare the output against the existing `.verdicts.json` file
   c. If verdicts differ, investigate and update `.verdicts.json` to match correct evaluator output

3. Verify each scenario exercises the expected contract paths:
   - `prior_auth_approve`: All clinical criteria met, should produce authorization_approved verdict, flow outcome "approved"
   - `prior_auth_deny`: Clinical criteria not met, should produce authorization_denied verdict, flow reaches appeal subflow
   - `prior_auth_appeal`: Appeal with merit/new evidence, should produce overturn_recommended verdict, flow outcome "appeal_granted"

4. If any .verdicts.json files were regenerated, ensure the verdict structure matches the evaluator output format.
  </action>
  <verify>
- All three evaluation scenarios produce verdicts matching expected output files
- Flow outcomes match expected paths through the contract
  </verify>
  <done>All three healthcare evaluation scenarios (approve, deny, appeal) produce correct verdicts</done>
</task>

</tasks>

<verification>
- Healthcare contract elaborates without errors under v1.0
- Static analysis produces clean results for this complex contract
- All three evaluation scenarios produce correct verdicts
- No regressions in conformance suite: `cargo run -p tenor-cli -- test conformance`
</verification>

<success_criteria>
DOMN-11 satisfied: Healthcare prior auth contract is validated for v1.0 spec with clean elaboration, analysis, and evaluation results across all three scenarios.
</success_criteria>

<output>
After completion, create `.planning/phases/13-domain-re-validation/13-02-SUMMARY.md`
</output>
