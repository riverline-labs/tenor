---
phase: 13-domain-re-validation
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - domains/supply_chain/inspection.tenor
  - domains/supply_chain/types.tenor
  - domains/supply_chain/inspection_pass.facts.json
  - domains/supply_chain/inspection_pass.verdicts.json
  - domains/supply_chain/inspection_hold.facts.json
  - domains/supply_chain/inspection_hold.verdicts.json
autonomous: true
requirements: [DOMN-12]

must_haves:
  truths:
    - "Supply chain inspection contract elaborates cleanly under v1.0 spec"
    - "tenor check produces clean results (no findings beyond acknowledged limitations)"
    - "Both evaluation scenarios (pass, hold) produce correct verdicts"
    - "Contract exercises ParallelStep, Compensate handler, multi-entity effects, entity hierarchy, bounded quantification, multi-file import"
  artifacts:
    - path: "domains/supply_chain/inspection.tenor"
      provides: "Supply chain inspection contract validated for v1.0"
    - path: "domains/supply_chain/types.tenor"
      provides: "Shared type definitions for supply chain domain"
    - path: "domains/supply_chain/inspection_pass.verdicts.json"
      provides: "Pass scenario evaluation verdicts"
    - path: "domains/supply_chain/inspection_hold.verdicts.json"
      provides: "Hold scenario evaluation verdicts"
  key_links:
    - from: "domains/supply_chain/inspection.tenor"
      to: "tenor elaborate"
      via: "elaboration pipeline (multi-file with import)"
      pattern: "cargo run -p tenor-cli -- elaborate"
    - from: "domains/supply_chain/inspection.tenor"
      to: "tenor check"
      via: "static analysis pipeline"
      pattern: "cargo run -p tenor-cli -- check"
---

<objective>
Re-validate the supply chain inspection domain contract against the v1.0 spec.

Purpose: Confirm the supply chain contract -- exercising ParallelStep, Compensate handler, multi-entity effects (Shipment + QualityLot + ComplianceLot), bounded universal quantification, and multi-file import -- elaborates cleanly, passes static analysis, and evaluates correctly under v1.0.

Output: Validated supply chain contract with updated evaluation fixtures if needed, clean elaboration and check results.
</objective>

<execution_context>
@/Users/bwb/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bwb/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@domains/supply_chain/inspection.tenor
@domains/supply_chain/types.tenor
@domains/supply_chain/inspection_pass.facts.json
@domains/supply_chain/inspection_pass.verdicts.json
@domains/supply_chain/inspection_hold.facts.json
@domains/supply_chain/inspection_hold.verdicts.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Validate supply chain contract elaboration and static analysis under v1.0</name>
  <files>
domains/supply_chain/inspection.tenor
domains/supply_chain/types.tenor
  </files>
  <action>
1. Read `domains/supply_chain/inspection.tenor` and `domains/supply_chain/types.tenor` and audit against v1.0 spec (`docs/TENOR.md`):
   - Verify all construct syntax matches v1.0 (import mechanism, persona declarations, operation outcomes/error_contract, ParallelStep with Branch/JoinPolicy syntax, Compensate handler syntax, entity transitions)
   - Confirm the contract exercises: ParallelStep (concurrent quality + compliance inspections), Compensate handler (rollback on hold failure), multi-entity effects (Shipment, QualityLot, ComplianceLot), bounded universal quantification (forall item in inspection_items), multi-file import (types.tenor with InspectionItem, InspectionReport types)
   - If any syntax needs updating for v1.0 compliance, update the .tenor files

2. Run `cargo run -p tenor-cli -- elaborate domains/supply_chain/inspection.tenor` and verify clean JSON output (no errors). Note: this is a multi-file contract -- elaborate should resolve the `import "types.tenor"` relative to the inspection.tenor location.

3. Run `cargo run -p tenor-cli -- check domains/supply_chain/inspection.tenor` and verify results:
   - Confirm entity reachability for all 3 entities (Shipment, QualityLot, ComplianceLot)
   - Confirm authority topology for 4 personas
   - Confirm flow path analysis for inspection_flow with parallel branches
   - Document any findings
  </action>
  <verify>
- `cargo run -p tenor-cli -- elaborate domains/supply_chain/inspection.tenor` exits 0 with valid JSON
- `cargo run -p tenor-cli -- check domains/supply_chain/inspection.tenor` exits 0 with clean results
  </verify>
  <done>Supply chain inspection contract elaborates and passes static analysis under v1.0 spec</done>
</task>

<task type="auto">
  <name>Task 2: Validate supply chain evaluation fixtures and verdict correctness</name>
  <files>
domains/supply_chain/inspection_pass.facts.json
domains/supply_chain/inspection_pass.verdicts.json
domains/supply_chain/inspection_hold.facts.json
domains/supply_chain/inspection_hold.verdicts.json
  </files>
  <action>
1. Elaborate the supply chain contract to a bundle JSON file:
   `cargo run -p tenor-cli -- elaborate domains/supply_chain/inspection.tenor > /tmp/supply_chain_bundle.json`

2. For each evaluation scenario (pass, hold):
   a. Run the evaluator: `cargo run -p tenor-cli -- eval /tmp/supply_chain_bundle.json --facts domains/supply_chain/inspection_{scenario}.facts.json`
   b. Compare the output against the existing `.verdicts.json` file
   c. If verdicts differ, investigate and update `.verdicts.json` to match correct evaluator output

3. Verify each scenario exercises the expected contract paths:
   - `inspection_pass`: All quality/compliance checks pass, defects below threshold, should produce clearance_approved verdict, flow outcome "shipment_cleared" through parallel branches
   - `inspection_hold`: Defects exceed threshold or quality/compliance fails, should produce hold_required verdict, flow outcome "shipment_held"

4. If any .verdicts.json files were regenerated, ensure the verdict structure matches the evaluator output format including parallel step execution records.
  </action>
  <verify>
- Both evaluation scenarios produce verdicts matching expected output files
- Flow outcomes match expected paths (including parallel branch execution)
  </verify>
  <done>Both supply chain evaluation scenarios (pass, hold) produce correct verdicts</done>
</task>

</tasks>

<verification>
- Supply chain contract elaborates without errors under v1.0 (including import resolution)
- Static analysis produces clean results for multi-entity contract
- Both evaluation scenarios produce correct verdicts
- No regressions in conformance suite: `cargo run -p tenor-cli -- test conformance`
</verification>

<success_criteria>
DOMN-12 satisfied: Supply chain inspection contract is validated for v1.0 spec with clean elaboration, analysis, and evaluation results.
</success_criteria>

<output>
After completion, create `.planning/phases/13-domain-re-validation/13-03-SUMMARY.md`
</output>
