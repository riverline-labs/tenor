---
phase: 03.4-contract-discovery
plan: 02
subsystem: testing
tags: [conformance, manifest, etag, sha2, runner]

requires:
  - phase: 03.4-contract-discovery
    provides: compute_etag, build_manifest, --manifest flag
provides:
  - "Manifest conformance test fixtures in conformance/manifest/"
  - "run_manifest_tests runner integration in conformance suite"
  - "Deterministic etag verification across runs"
affects: [phase-5]

tech-stack:
  added: []
  patterns: [manifest conformance fixture convention (.tenor + .expected-manifest.json)]

key-files:
  created:
    - conformance/manifest/manifest_basic.tenor
    - conformance/manifest/manifest_basic.expected-manifest.json
  modified:
    - crates/cli/src/runner.rs

key-decisions:
  - "Runner duplicates etag/envelope logic (~10 lines) rather than extracting shared module -- keeps runner self-contained"
  - "Expected manifest fixtures generated from elaborator output (same convention as interchange fixtures)"

patterns-established:
  - "Manifest test convention: .tenor + .expected-manifest.json in conformance/manifest/"
  - "Runner manifest test: elaborate -> wrap in envelope with SHA-256 etag -> compare against expected"

requirements-completed: [SPEC-08, CLI-10]

duration: 5min
completed: 2026-02-22
---

# Plan 03.4-02: Manifest Conformance Tests Summary

**Manifest conformance runner with SHA-256 etag verification and expected-manifest fixtures integrated into `tenor test conformance`**

## Performance

- **Duration:** 5 min
- **Started:** 2026-02-22
- **Completed:** 2026-02-22
- **Tasks:** 2
- **Files modified:** 3

## Accomplishments
- `conformance/manifest/` directory with manifest_basic test fixture
- Conformance runner integrates manifest tests -- elaborates, wraps in envelope, verifies etag and structure
- Full suite now 57 tests (56 existing + 1 manifest), all passing
- Etag independently verified (SHA-256 of compact bundle JSON matches)

## Task Commits

Each task was committed atomically:

1. **Task 1+2: Create manifest fixtures and runner integration** - `e3d7af3` (test)

## Files Created/Modified
- `conformance/manifest/manifest_basic.tenor` - Minimal contract for manifest test
- `conformance/manifest/manifest_basic.expected-manifest.json` - Expected manifest output with correct etag
- `crates/cli/src/runner.rs` - run_manifest_tests and run_manifest_test functions, sha2 import

## Decisions Made
- Runner duplicates etag/envelope logic rather than creating shared module -- simpler, avoids coupling runner to main.rs internals
- Fixtures generated from elaborator output (convention per project decision)

## Deviations from Plan
None - plan executed exactly as written.

## Issues Encountered
None.

## User Setup Required
None - no external service configuration required.

## Next Phase Readiness
- Phase 3.4 all plans complete, ready for verification
- Manifest generation and testing fully operational

---
*Phase: 03.4-contract-discovery*
*Completed: 2026-02-22*
