---
phase: 03.1-cffp-migration-semantics
plan: 01
subsystem: spec
tags: [cffp, migration, breaking-changes, taxonomy, versioning, diff]

# Dependency graph
requires:
  - phase: 03-cli-evaluator
    provides: "Structural diff implementation (diff.rs, MIGR-01) providing DiffEntry foundation"
  - phase: 01-spec-completion
    provides: "CFFP protocol (cffp.cue) and prior CFFP runs (persona, P7, P5) as process precedent"
provides:
  - "Complete CFFP run artifact (docs/cffp/migration-semantics.json) with breaking change taxonomy"
  - "Classification of every (construct_kind, field, change_type) triple as BREAKING/NON_BREAKING/REQUIRES_ANALYSIS"
  - "Hybrid diff representation decision: DiffEntry JSON primary + Tenor migration contract secondary"
  - "In-flight flow migration policy requirement (blue_green, force_migrate, abort)"
affects: [04-static-analysis, 03.1-02]

# Tech tracking
tech-stack:
  added: []
  patterns: [cffp-multi-candidate-collapse, hybrid-dual-representation, taxonomy-exhaustive-enumeration]

key-files:
  created:
    - docs/cffp/migration-semantics.json
  modified: []

key-decisions:
  - "Hybrid (Candidate C) selected via collapse of all three survivors — DiffEntry JSON is primary authoritative output, migration contract is supplementary"
  - "Migration contracts in v1.0 are classification-only (Facts + Rules) — orchestration deferred to v2"
  - "Migration contracts are self-contained — no imports of source contracts due to namespace collision"
  - "Migration contract composition is not supported — transitive migration via direct endpoint diffing only"
  - "REQUIRES_ANALYSIS is a valid third classification for predicate expression changes where strength comparison is undecidable"
  - "In-flight flow migration policy is an executor deployment obligation, not a contract-level construct"
  - "Per-flow-type policies permitted if every active flow type has a declared policy"

patterns-established:
  - "CFFP collapse pattern: when multiple candidates survive, check if one subsumes the others before selecting"
  - "Taxonomy exhaustiveness via interchange schema enumeration: every $defs field yields taxonomy entries"
  - "Dual new-flow vs in-flight-flow impact analysis for every breaking change classification"

requirements-completed: [MIGR-02]

# Metrics
duration: 8min
completed: 2026-02-21
---

# Phase 3.1 Plan 01: CFFP Migration Semantics Summary

**CFFP-derived breaking change taxonomy classifying every construct field change as BREAKING/NON_BREAKING/REQUIRES_ANALYSIS, with hybrid diff representation (DiffEntry JSON + optional Tenor migration contract)**

## Performance

- **Duration:** 8 min
- **Started:** 2026-02-21T23:59:41Z
- **Completed:** 2026-02-22T00:07:51Z
- **Tasks:** 2
- **Files modified:** 1

## Accomplishments

- Complete CFFP run (6 phases) resolving the "Should Tenor diffs be expressed as Tenor contracts?" design question from CONTEXT.md
- Breaking change taxonomy covering all six construct kinds (Fact, Entity, Rule, Persona, Operation, Flow) with per-field per-change-type classifications
- All seven pressure test questions from CONTEXT.md addressed through 13 counterexamples (8 targeting Candidate B, 2 targeting A, 2 targeting C, 1 cross-candidate)
- In-flight flow migration policy formalized as executor obligation with three options (blue_green, force_migrate, abort)

## Task Commits

Each task was committed atomically:

1. **Task 1: CFFP Phases 1-3 (Invariants, Candidates, Pressure Testing)** - `4bac83e` (feat)
2. **Task 2: CFFP Phases 4-6 (Collapse, Static Obligations, Canonicalization)** - `83baf17` (feat)

## Files Created/Modified

- `docs/cffp/migration-semantics.json` - Complete CFFP instance with 7 invariants, 3 candidates, 13 counterexamples, collapse test, 5 static obligations, and canonical form with exhaustive breaking change taxonomy

## Decisions Made

1. **Hybrid selected (Candidate C via collapse):** All three candidates survived Phase 3 — A with no narrowings, B with 7 narrowings, C with 1 narrowing. Phase 4 collapse merged all into C_merged. Rationale: C is a natural superset of A (includes DiffEntry JSON) and B (includes migration contract). Per user directive favoring Tenor contract output, the hybrid provides both the reliable JSON diff and the aspirational migration-as-contract capability.

2. **Classification-only migration contracts:** Pressure testing (CE1, CE2, CE5, CE8) revealed that v1.0 Tenor constructs can express diff classification (Facts + Rules) but NOT migration orchestration (meta-level Operations/Flows). Scope narrowed to classification-only in v1.0.

3. **Self-contained migration contracts:** Import namespace collisions (CE3) force migration contracts to be self-contained with all diff data encoded as internal Facts. No cross-contract referencing.

4. **REQUIRES_ANALYSIS as valid classification:** Predicate strength comparison is undecidable in general (CE2, CE11). MI3 explicitly permits REQUIRES_ANALYSIS for predicate changes, deferring refinement to S3a/S3b static analysis.

5. **Three migration policies (blue_green, force_migrate, abort):** Policy is executor concern only (MI6), must cover all in-flight flows (MI7), is mandatory when breaking changes exist (MI5).

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- CFFP artifact complete at `docs/cffp/migration-semantics.json`
- Plan 03.1-02 can proceed to add the Versioning & Migration section to TENOR.md using the taxonomy from this CFFP run
- Phase 4 (Static Analysis) can reference the taxonomy for `tenor diff --breaking` implementation
- The taxonomy is immediately usable as a lookup table: given a DiffEntry from diff.rs, look up (kind, field, change_type) to get BREAKING/NON_BREAKING/REQUIRES_ANALYSIS

## Self-Check: PASSED

- FOUND: docs/cffp/migration-semantics.json
- FOUND: 03.1-01-SUMMARY.md
- FOUND: 4bac83e (Task 1 commit)
- FOUND: 83baf17 (Task 2 commit)

---
*Phase: 03.1-cffp-migration-semantics*
*Completed: 2026-02-21*
